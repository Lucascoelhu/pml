<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loj√£o PML - Card√°pio Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        
        body {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .product-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .quantity-btn {
            transition: all 0.2s;
        }
        
        .quantity-btn:active {
            transform: scale(0.9);
        }
        
        .cart-badge {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .category-pill {
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .category-pill.active {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        
        .success-check {
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes scaleIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .floating-cart {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 50;
            filter: drop-shadow(0 10px 30px rgba(99, 102, 241, 0.4));
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 600;
            z-index: 100;
            opacity: 0;
            transition: all 0.3s;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="text-slate-100 pb-24">

    <!-- Header -->
    <header class="sticky top-0 z-40 glass border-b border-slate-700/50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-store text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Loj√£o PML</h1>
                        <p class="text-xs text-slate-400">Card√°pio Digital</p>
                    </div>
                </div>
                <button onclick="toggleCart()" class="relative w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center hover:bg-slate-700 transition-colors border border-slate-700">
                    <i class="fas fa-shopping-cart text-lg text-indigo-400"></i>
                    <span id="cartCount" class="hidden absolute -top-1 -right-1 min-w-[24px] h-6 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center px-1 border-2 border-slate-900">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="glass rounded-3xl p-8 mb-8 bg-gradient-to-r from-indigo-600/20 via-purple-600/20 to-pink-600/20 border-indigo-500/30 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 h-64 bg-purple-500/20 rounded-full blur-3xl -mr-32 -mt-32"></div>
            <div class="relative z-10">
                <h2 class="text-4xl font-bold text-white mb-3">Bem-vindo! üëã</h2>
                <p class="text-slate-300 text-lg max-w-xl">Fa√ßa seu pedido de forma r√°pida e f√°cil. Preparamos tudo com muito carinho para voc√™!</p>
            </div>
        </div>

        <!-- Search -->
        <div class="relative mb-6">
            <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="O que voc√™ est√° procurando?" 
                class="w-full glass rounded-2xl pl-14 pr-6 py-5 text-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 border border-slate-700/50">
            <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 text-xl"></i>
        </div>

        <!-- Categories -->
        <div class="flex gap-3 overflow-x-auto pb-4 mb-8 scrollbar-hide">
            <button onclick="filterCategory('all')" class="category-pill active px-6 py-3 rounded-full bg-slate-800 text-slate-300 font-semibold">
                Todos
            </button>
            <button onclick="filterCategory('lanche')" class="category-pill px-6 py-3 rounded-full bg-slate-800 text-slate-300 font-semibold">
                üçî Lanches
            </button>
            <button onclick="filterCategory('bebida')" class="category-pill px-6 py-3 rounded-full bg-slate-800 text-slate-300 font-semibold">
                ü•§ Bebidas
            </button>
            <button onclick="filterCategory('combo')" class="category-pill px-6 py-3 rounded-full bg-slate-800 text-slate-300 font-semibold">
                üéÅ Combos
            </button>
            <button onclick="filterCategory('sobremesa')" class="category-pill px-6 py-3 rounded-full bg-slate-800 text-slate-300 font-semibold">
                üç∞ Sobremesas
            </button>
        </div>

        <!-- Products Grid -->
        <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Loading State -->
            <div class="col-span-full text-center py-20">
                <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="text-slate-400">Carregando card√°pio...</p>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 bg-black/80 z-50 hidden">
        <div class="absolute inset-y-0 right-0 w-full max-w-md bg-slate-900 shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col border-l border-slate-700" id="cartPanel">
            
            <!-- Cart Header -->
            <div class="glass p-6 border-b border-slate-700 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-white flex items-center gap-3">
                    <div class="w-10 h-10 bg-indigo-500/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-shopping-cart text-indigo-400"></i>
                    </div>
                    Seu Pedido
                </h2>
                <button onclick="toggleCart()" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-slate-700 transition-colors">
                    <i class="fas fa-times text-slate-400"></i>
                </button>
            </div>

            <!-- Cart Items -->
            <div class="flex-1 overflow-y-auto p-6" id="cartItems">
                <div class="text-center text-slate-500 mt-20">
                    <div class="w-24 h-24 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-shopping-basket text-4xl text-slate-600"></i>
                    </div>
                    <p class="text-lg mb-2">Seu carrinho est√° vazio</p>
                    <p class="text-sm text-slate-600">Adicione itens deliciosos!</p>
                </div>
            </div>

            <!-- Cart Footer -->
            <div class="glass p-6 border-t border-slate-700 space-y-4">
                <div class="flex justify-between items-center text-lg">
                    <span class="text-slate-400">Subtotal</span>
                    <span class="font-semibold text-white" id="cartSubtotal">R$ 0,00</span>
                </div>
                <div class="flex justify-between items-center text-2xl font-bold">
                    <span class="text-white">Total</span>
                    <span class="text-emerald-400" id="cartTotal">R$ 0,00</span>
                </div>
                <button onclick="openCheckout()" id="checkoutBtn" disabled 
                    class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 rounded-2xl transition-all transform hover:scale-[1.02] flex items-center justify-center gap-3 shadow-lg shadow-indigo-600/25">
                    <span>Finalizar Pedido</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="fixed inset-0 bg-black/90 z-[60] hidden items-center justify-center p-4">
        <div class="glass w-full max-w-lg rounded-3xl p-8 max-h-[90vh] overflow-y-auto border border-slate-700">
            <h2 class="text-3xl font-bold text-white mb-2">Finalizar Pedido</h2>
            <p class="text-slate-400 mb-8">Preencha seus dados para entrega</p>

            <form id="checkoutForm" onsubmit="submitOrder(event)" class="space-y-5">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Nome Completo *</label>
                    <input type="text" id="customerName" required 
                        class="w-full bg-slate-800 border border-slate-700 rounded-xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all text-lg"
                        placeholder="Seu nome completo">
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">WhatsApp *</label>
                    <input type="tel" id="customerPhone" required 
                        class="w-full bg-slate-800 border border-slate-700 rounded-xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all text-lg"
                        placeholder="5511999999999">
                    <p class="text-xs text-slate-500 mt-2">Formato: 55 + DDD + N√∫mero (ex: 5511987654321)</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Endere√ßo de Entrega *</label>
                    <textarea id="customerAddress" required rows="3"
                        class="w-full bg-slate-800 border border-slate-700 rounded-xl px-5 py-4 text-white focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all resize-none"
                        placeholder="Rua, n√∫mero, bairro, ponto de refer√™ncia..."></textarea>
                </div>

                <div class="bg-slate-800/50 p-5 rounded-2xl border border-slate-700">
                    <p class="text-sm text-slate-400 mb-3 font-medium">Resumo do Pedido:</p>
                    <div id="checkoutSummary" class="space-y-2 text-sm max-h-40 overflow-y-auto mb-4">
                        <!-- Preenchido via JS -->
                    </div>
                    <div class="border-t border-slate-700 pt-4 flex justify-between items-center">
                        <span class="text-slate-300 font-medium">Total</span>
                        <span class="text-2xl font-bold text-emerald-400" id="checkoutTotal">R$ 0,00</span>
                    </div>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="closeCheckout()" 
                        class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-4 rounded-xl transition-colors font-semibold">
                        Voltar
                    </button>
                    <button type="submit" 
                        class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-4 rounded-xl transition-all font-bold flex items-center justify-center gap-3 shadow-lg shadow-green-600/25">
                        <i class="fab fa-whatsapp text-xl"></i>
                        Enviar Pedido
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/95 z-[70] hidden items-center justify-center p-4">
        <div class="glass w-full max-w-md rounded-3xl p-10 text-center border border-emerald-500/30 success-check">
            <div class="w-28 h-28 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-green-500/30">
                <i class="fas fa-check text-5xl text-white"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-3">Pedido Enviado!</h2>
            <p class="text-slate-400 mb-8 text-lg">Seu pedido foi recebido com sucesso. Em breve entraremos em contato!</p>
            
            <div class="bg-slate-800/50 p-6 rounded-2xl mb-8 border border-slate-700">
                <p class="text-sm text-slate-400 mb-2">N√∫mero do Pedido</p>
                <p class="text-4xl font-bold text-indigo-400 font-mono tracking-wider" id="successOrderId">#0000</p>
            </div>
            
            <button onclick="closeSuccess()" 
                class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white py-4 rounded-2xl transition-all font-bold text-lg shadow-lg shadow-indigo-600/25">
                Fazer Novo Pedido
            </button>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle mr-2"></i>
        <span>Item adicionado!</span>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDocs, 
            query,
            where,
            onSnapshot,
            Timestamp 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBmnd1kHE9-7uFzFpiFCbaYeMEAHPwDoXw",
            authDomain: "lojao-pml.firebaseapp.com",
            projectId: "lojao-pml",
            storageBucket: "lojao-pml.firebasestorage.app",
            messagingSenderId: "380150226397",
            appId: "1:380150226397:web:5abfd9e07a72545f75aa34"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // State
        let products = [];
        let cart = {};
        let currentCategory = 'all';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
        });

        function loadProducts() {
            const q = query(collection(db, "produtos"), where("ativo", "==", true));
            
            onSnapshot(q, (snapshot) => {
                products = [];
                snapshot.forEach(doc => {
                    products.push({ id: doc.id, ...doc.data() });
                });
                renderProducts();
            });
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            const filtered = currentCategory === 'all' 
                ? products 
                : products.filter(p => p.categoria === currentCategory);

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20 text-slate-500">
                        <i class="fas fa-search text-6xl mb-6 opacity-30"></i>
                        <p class="text-xl">Nenhum produto encontrado</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(product => {
                const qty = cart[product.id] || 0;
                const outOfStock = (product.estoque || 0) <= 0;
                
                return `
                    <div class="product-card glass rounded-3xl overflow-hidden border border-slate-700/50 ${outOfStock ? 'opacity-60' : ''}">
                        <div class="h-56 bg-gradient-to-br from-slate-800 to-slate-700 flex items-center justify-center text-7xl relative overflow-hidden">
                            ${product.imagem ? 
                                `<img src="${product.imagem}" class="w-full h-full object-cover">` : 
                                '<span class="text-6xl">üçî</span>'
                            }
                            ${(product.estoque || 0) < 5 && !outOfStock ? 
                                '<span class="absolute top-4 right-4 bg-red-500 text-white text-xs font-bold px-3 py-1.5 rounded-full">√öltimas unidades</span>' : 
                                ''
                            }
                            ${outOfStock ? 
                                '<span class="absolute inset-0 bg-black/60 flex items-center justify-center"><span class="bg-red-500 text-white font-bold px-4 py-2 rounded-full">ESGOTADO</span></span>' : 
                                ''
                            }
                        </div>
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-3">
                                <h3 class="text-xl font-bold text-white leading-tight">${product.nome}</h3>
                                <span class="text-2xl font-bold text-emerald-400">R$ ${(product.precoVenda || 0).toFixed(2)}</span>
                            </div>
                            <p class="text-slate-400 text-sm mb-4 line-clamp-2">${product.descricao || 'Delicioso produto feito com ingredientes selecionados'}</p>
                            
                            <div class="flex items-center justify-between">
                                <span class="text-sm ${(product.estoque || 0) < 10 ? 'text-red-400' : 'text-slate-500'} font-medium">
                                    ${outOfStock ? 'Indispon√≠vel' : `${product.estoque} dispon√≠veis`}
                                </span>
                                
                                ${outOfStock ? '' : qty === 0 ? `
                                    <button onclick="addToCart('${product.id}')" 
                                        class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-6 py-3 rounded-xl font-bold transition-all transform hover:scale-105 flex items-center gap-2 shadow-lg shadow-indigo-600/25">
                                        <i class="fas fa-plus"></i>
                                        Adicionar
                                    </button>
                                ` : `
                                    <div class="flex items-center gap-3 bg-slate-800 rounded-2xl p-2 border border-slate-700">
                                        <button onclick="updateQuantity('${product.id}', -1)" 
                                            class="quantity-btn w-10 h-10 rounded-xl bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-white transition-colors">
                                            <i class="fas fa-minus text-sm"></i>
                                        </button>
                                        <span class="w-10 text-center font-bold text-xl text-white">${qty}</span>
                                        <button onclick="updateQuantity('${product.id}', 1)" 
                                            class="quantity-btn w-10 h-10 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 flex items-center justify-center text-white transition-colors shadow-lg">
                                            <i class="fas fa-plus text-sm"></i>
                                        </button>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.category-pill').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderProducts();
        }

        function searchProducts() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.product-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(term) ? '' : 'none';
            });
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.estoque <= 0) return;
            
            cart[productId] = 1;
            updateCartUI();
            renderProducts();
            showToast(`${product.nome} adicionado!`);
        }

        function updateQuantity(productId, change) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const current = cart[productId] || 0;
            const next = current + change;

            if (next <= 0) {
                delete cart[productId];
            } else if (next <= product.estoque) {
                cart[productId] = next;
            } else {
                showToast('Quantidade m√°xima atingida!', 'error');
                return;
            }

            updateCartUI();
            renderProducts();
        }

        function updateCartUI() {
            const count = Object.values(cart).reduce((a, b) => a + b, 0);
            const badge = document.getElementById('cartCount');
            const btn = document.getElementById('checkoutBtn');
            
            if (count > 0) {
                badge.textContent = count;
                badge.classList.remove('hidden');
                btn.disabled = false;
            } else {
                badge.classList.add('hidden');
                btn.disabled = true;
            }

            renderCartItems();
        }

        function renderCartItems() {
            const container = document.getElementById('cartItems');
            const ids = Object.keys(cart);
            
            if (ids.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-slate-500 mt-20">
                        <div class="w-24 h-24 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-shopping-basket text-4xl text-slate-600"></i>
                        </div>
                        <p class="text-lg mb-2">Seu carrinho est√° vazio</p>
                        <p class="text-sm text-slate-600">Adicione itens deliciosos!</p>
                    </div>
                `;
                updateTotals();
                return;
            }

            container.innerHTML = ids.map(id => {
                const product = products.find(p => p.id === id);
                const qty = cart[id];
                
                return `
                    <div class="slide-in glass p-4 rounded-2xl mb-3 flex items-center gap-4 border border-slate-700/50">
                        <div class="w-16 h-16 bg-slate-800 rounded-xl flex items-center justify-center text-2xl flex-shrink-0">
                            ${product.imagem ? `<img src="${product.imagem}" class="w-full h-full object-cover rounded-xl">` : 'üçî'}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-bold text-white truncate">${product.nome}</h4>
                            <p class="text-emerald-400 font-semibold">R$ ${(product.precoVenda * qty).toFixed(2)}</p>
                        </div>
                        <div class="flex items-center gap-2 bg-slate-800 rounded-xl p-1">
                            <button onclick="updateQuantity('${product.id}', -1)" class="w-8 h-8 rounded-lg bg-slate-700 hover:bg-slate-600 flex items-center justify-center transition-colors">
                                <i class="fas fa-minus text-xs"></i>
                            </button>
                            <span class="w-8 text-center font-bold text-white">${qty}</span>
                            <button onclick="updateQuantity('${product.id}', 1)" class="w-8 h-8 rounded-lg bg-indigo-600 hover:bg-indigo-700 flex items-center justify-center transition-colors">
                                <i class="fas fa-plus text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            updateTotals();
        }

        function updateTotals() {
            let total = 0;
            Object.entries(cart).forEach(([id, qty]) => {
                const product = products.find(p => p.id === id);
                if (product) total += product.precoVenda * qty;
            });

            document.getElementById('cartSubtotal').textContent = `R$ ${total.toFixed(2)}`;
            document.getElementById('cartTotal').textContent = `R$ ${total.toFixed(2)}`;
        }

        function toggleCart() {
            const modal = document.getElementById('cartModal');
            const panel = document.getElementById('cartPanel');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => panel.classList.remove('translate-x-full'), 10);
            } else {
                panel.classList.add('translate-x-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function openCheckout() {
            toggleCart();
            
            const summary = document.getElementById('checkoutSummary');
            let total = 0;
            
            summary.innerHTML = Object.entries(cart).map(([id, qty]) => {
                const product = products.find(p => p.id === id);
                const itemTotal = product.precoVenda * qty;
                total += itemTotal;
                
                return `
                    <div class="flex justify-between items-center py-2 border-b border-slate-800 last:border-0">
                        <div class="flex items-center gap-2">
                            <span class="text-indigo-400 font-bold">${qty}x</span>
                            <span class="text-slate-300">${product.nome}</span>
                        </div>
                        <span class="text-white font-medium">R$ ${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
            
            document.getElementById('checkoutTotal').textContent = `R$ ${total.toFixed(2)}`;
            document.getElementById('checkoutModal').classList.remove('hidden');
            document.getElementById('checkoutModal').classList.add('flex');
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').classList.add('hidden');
            document.getElementById('checkoutModal').classList.remove('flex');
        }

        async function submitOrder(e) {
            e.preventDefault();
            
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const address = document.getElementById('customerAddress').value;
            
            const items = Object.entries(cart).map(([id, qty]) => {
                const product = products.find(p => p.id === id);
                return {
                    produtoId: id,
                    nome: product.nome,
                    quantidade: qty,
                    preco: product.precoVenda
                };
            });
            
            const total = items.reduce((sum, item) => sum + (item.preco * item.quantidade), 0);
            
            const order = {
                id: 'ped_' + Date.now(),
                clienteNome: name,
                clienteTelefone: phone,
                clienteEndereco: address,
                itens: items,
                total: total,
                status: 'pendente',
                dataCriacao: new Date().toISOString()
            };
            
            try {
                await setDoc(doc(db, "pedidos", order.id), order);
                
                document.getElementById('successOrderId').textContent = '#' + order.id.slice(-4);
                document.getElementById('checkoutModal').classList.add('hidden');
                document.getElementById('successModal').classList.remove('hidden');
                document.getElementById('successModal').classList.add('flex');
                
                cart = {};
                updateCartUI();
            } catch (error) {
                console.error(error);
                showToast('Erro ao enviar pedido. Tente novamente.', 'error');
            }
        }

        function closeSuccess() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
            document.getElementById('checkoutForm').reset();
            renderProducts();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.innerHTML = type === 'error' ? 
                `<i class="fas fa-exclamation-circle mr-2"></i><span>${message}</span>` :
                `<i class="fas fa-check-circle mr-2"></i><span>${message}</span>`;
            toast.style.background = type === 'error' ? 
                'linear-gradient(135deg, #ef4444, #dc2626)' : 
                'linear-gradient(135deg, #10b981, #059669)';
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        // Close modals on outside click
        window.onclick = function(e) {
            if (e.target.id === 'cartModal') toggleCart();
            if (e.target.id === 'checkoutModal') closeCheckout();
        };

        // Expose to window
        window.toggleCart = toggleCart;
        window.openCheckout = openCheckout;
        window.closeCheckout = closeCheckout;
        window.closeSuccess = closeSuccess;
        window.filterCategory = filterCategory;
        window.searchProducts = searchProducts;
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.submitOrder = submitOrder;
    </script>
</body>
</html>
