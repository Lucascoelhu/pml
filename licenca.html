<!-- LICENCA.HTML - Gerenciador de Assinaturas -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja Pro - Gerenciador de Licenças</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .license-card {
            transition: all 0.3s ease;
        }
        
        .license-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .status-active {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .status-inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            transition: all 0.3s;
        }
        
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        
        .code-display {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }
        
        /* Animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body class="text-slate-100 p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12 animate-slide-in">
            <div class="w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl">
                <i class="fas fa-key text-3xl text-white"></i>
            </div>
            <h1 class="text-4xl font-bold mb-2">Gerenciador de Licenças</h1>
            <p class="text-slate-400">Sistema de controle de assinaturas Loja Pro</p>
        </div>

        <!-- Estatísticas -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 animate-slide-in">
            <div class="glass rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-check-circle text-green-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white mb-1" id="activeCount">0</h3>
                <p class="text-slate-400">Licenças Ativas</p>
            </div>
            
            <div class="glass rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-times-circle text-red-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white mb-1" id="inactiveCount">0</h3>
                <p class="text-slate-400">Licenças Inativas</p>
            </div>
            
            <div class="glass rounded-2xl p-6 text-center">
                <div class="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-calendar text-blue-400 text-xl"></i>
                </div>
                <h3 class="text-3xl font-bold text-white mb-1" id="expiringCount">0</h3>
                <p class="text-slate-400">Expirando em 7 dias</p>
            </div>
        </div>

        <!-- Gerar Nova Licença -->
        <div class="glass rounded-2xl p-8 mb-8 animate-slide-in">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                <i class="fas fa-plus-circle text-indigo-400"></i>
                Gerar Nova Licença
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Nome do Estabelecimento</label>
                    <input type="text" id="newLicenseName" placeholder="Ex: Loja do João" 
                        class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500 transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Duração (dias)</label>
                    <select id="newLicenseDuration" 
                        class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-indigo-500 transition-colors">
                        <option value="7">7 dias (Teste)</option>
                        <option value="30" selected>30 dias (Mensal)</option>
                        <option value="90">90 dias (Trimestral)</option>
                        <option value="365">365 dias (Anual)</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button onclick="generateLicense()" 
                        class="w-full btn-gradient text-white font-semibold py-3 rounded-xl flex items-center justify-center gap-2">
                        <i class="fas fa-magic"></i>
                        Gerar Código
                    </button>
                </div>
            </div>

            <!-- Resultado -->
            <div id="generatedLicense" class="hidden bg-slate-800/50 rounded-xl p-6 border border-indigo-500/30">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="text-center md:text-left">
                        <p class="text-sm text-slate-400 mb-1">Código da Licença</p>
                        <p class="text-3xl font-bold code-display text-indigo-400" id="generatedCode"></p>
                        <p class="text-sm text-slate-400 mt-2">Válido por <span id="generatedDays"></span> dias</p>
                    </div>
                    <button onclick="copyCode()" class="bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-xl transition-colors flex items-center gap-2">
                        <i class="fas fa-copy"></i>
                        Copiar
                    </button>
                </div>
            </div>
        </div>

        <!-- Lista de Licenças -->
        <div class="glass rounded-2xl p-8 animate-slide-in">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-list text-indigo-400"></i>
                    Licenças Cadastradas
                </h2>
                <div class="flex gap-2">
                    <input type="text" id="searchLicense" onkeyup="searchLicenses()" placeholder="Buscar..." 
                        class="bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-2 text-white focus:outline-none focus:border-indigo-500">
                    <select id="filterStatus" onchange="filterLicenses()" 
                        class="bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-2 text-white focus:outline-none focus:border-indigo-500">
                        <option value="all">Todos</option>
                        <option value="active">Ativos</option>
                        <option value="inactive">Inativos</option>
                    </select>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-slate-700 text-left">
                            <th class="pb-4 text-slate-400 font-medium">Código</th>
                            <th class="pb-4 text-slate-400 font-medium">Estabelecimento</th>
                            <th class="pb-4 text-slate-400 font-medium">Status</th>
                            <th class="pb-4 text-slate-400 font-medium">Expiração</th>
                            <th class="pb-4 text-slate-400 font-medium text-right">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="licensesTable" class="divide-y divide-slate-700/50">
                        <!-- Preenchido via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Editar -->
    <div id="editModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center p-4 z-50">
        <div class="glass w-full max-w-md rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-4">Editar Licença</h3>
            <input type="hidden" id="editLicenseId">
            
            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Estabelecimento</label>
                    <input type="text" id="editLicenseName" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Nova Data de Expiração</label>
                    <input type="date" id="editLicenseExpiry" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white">
                </div>
                <div>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="editLicenseActive" class="w-5 h-5 rounded border-slate-600 text-indigo-600 bg-slate-700">
                        <span>Licença Ativa</span>
                    </label>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="closeEditModal()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg transition-colors">
                    Cancelar
                </button>
                <button onclick="saveLicenseEdit()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg transition-colors">
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        // Dados (simulando Firebase)
        let licenses = JSON.parse(localStorage.getItem('licenses') || '[]');

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            if (licenses.length === 0) {
                // Criar algumas licenças de exemplo
                licenses = [
                    {
                        id: 'LOJA-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                        name: 'Hamburgueria Top',
                        active: true,
                        createdAt: new Date().toISOString(),
                        expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 'LOJA-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                        name: 'Pizzaria Bella',
                        active: false,
                        createdAt: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString(),
                        expiryDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ];
                saveLicenses();
            }
            renderLicenses();
            updateStats();
        });

        function saveLicenses() {
            localStorage.setItem('licenses', JSON.stringify(licenses));
        }

        function generateLicense() {
            const name = document.getElementById('newLicenseName').value;
            const duration = parseInt(document.getElementById('newLicenseDuration').value);
            
            if (!name) {
                showToast('Digite o nome do estabelecimento', 'error');
                return;
            }

            const code = 'LOJA-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            const expiryDate = new Date(Date.now() + duration * 24 * 60 * 60 * 1000);

            const license = {
                id: code,
                name: name,
                active: true,
                createdAt: new Date().toISOString(),
                expiryDate: expiryDate.toISOString()
            };

            licenses.push(license);
            saveLicenses();

            // Mostrar resultado
            document.getElementById('generatedCode').textContent = code;
            document.getElementById('generatedDays').textContent = duration;
            document.getElementById('generatedLicense').classList.remove('hidden');
            
            renderLicenses();
            updateStats();
            showToast('Licença gerada com sucesso!', 'success');
        }

        function copyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('Código copiado!', 'success');
            });
        }

        function renderLicenses() {
            const tbody = document.getElementById('licensesTable');
            const filter = document.getElementById('filterStatus').value;
            const search = document.getElementById('searchLicense').value.toLowerCase();
            
            tbody.innerHTML = '';

            const filtered = licenses.filter(l => {
                const matchesSearch = l.name.toLowerCase().includes(search) || l.id.toLowerCase().includes(search);
                const matchesFilter = filter === 'all' || 
                    (filter === 'active' && isActive(l)) || 
                    (filter === 'inactive' && !isActive(l));
                return matchesSearch && matchesFilter;
            });

            filtered.forEach(license => {
                const active = isActive(license);
                const expiryDate = new Date(license.expiryDate);
                const daysLeft = Math.ceil((expiryDate - new Date()) / (1000 * 60 * 60 * 24));
                
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-800/30 transition-colors';
                tr.innerHTML = `
                    <td class="py-4">
                        <span class="code-display text-indigo-400 font-semibold">${license.id}</span>
                    </td>
                    <td class="py-4 text-white">${license.name}</td>
                    <td class="py-4">
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${active ? 'status-active' : 'status-inactive'}">
                            ${active ? '● Ativo' : '● Inativo'}
                        </span>
                    </td>
                    <td class="py-4">
                        <div class="text-slate-300">${expiryDate.toLocaleDateString('pt-BR')}</div>
                        ${active && daysLeft <= 7 ? `<div class="text-xs text-orange-400">Expira em ${daysLeft} dias</div>` : ''}
                    </td>
                    <td class="py-4 text-right">
                        <div class="flex justify-end gap-2">
                            <button onclick="toggleLicense('${license.id}')" 
                                class="w-8 h-8 rounded-lg ${active ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-green-500/20 text-green-400 hover:bg-green-500/30'} flex items-center justify-center transition-colors"
                                title="${active ? 'Desativar' : 'Ativar'}">
                                <i class="fas fa-power-off text-sm"></i>
                            </button>
                            <button onclick="editLicense('${license.id}')" 
                                class="w-8 h-8 rounded-lg bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 flex items-center justify-center transition-colors"
                                title="Editar">
                                <i class="fas fa-edit text-sm"></i>
                            </button>
                            <button onclick="deleteLicense('${license.id}')" 
                                class="w-8 h-8 rounded-lg bg-slate-700 text-slate-400 hover:bg-red-500/20 hover:text-red-400 flex items-center justify-center transition-colors"
                                title="Excluir">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function isActive(license) {
            return license.active && new Date(license.expiryDate) > new Date();
        }

        function toggleLicense(id) {
            const license = licenses.find(l => l.id === id);
            if (license) {
                license.active = !license.active;
                saveLicenses();
                renderLicenses();
                updateStats();
                showToast(license.active ? 'Licença ativada' : 'Licença desativada', 'success');
            }
        }

        function editLicense(id) {
            const license = licenses.find(l => l.id === id);
            if (!license) return;

            document.getElementById('editLicenseId').value = id;
            document.getElementById('editLicenseName').value = license.name;
            document.getElementById('editLicenseExpiry').value = license.expiryDate.split('T')[0];
            document.getElementById('editLicenseActive').checked = license.active;
            
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }

        function saveLicenseEdit() {
            const id = document.getElementById('editLicenseId').value;
            const license = licenses.find(l => l.id === id);
            
            if (license) {
                license.name = document.getElementById('editLicenseName').value;
                license.expiryDate = new Date(document.getElementById('editLicenseExpiry').value).toISOString();
                license.active = document.getElementById('editLicenseActive').checked;
                
                saveLicenses();
                renderLicenses();
                updateStats();
                closeEditModal();
                showToast('Licença atualizada!', 'success');
            }
        }

        function deleteLicense(id) {
            if (!confirm('Tem certeza que deseja excluir esta licença permanentemente?')) return;
            
            licenses = licenses.filter(l => l.id !== id);
            saveLicenses();
            renderLicenses();
            updateStats();
            showToast('Licença excluída', 'info');
        }

        function updateStats() {
            const now = new Date();
            const active = licenses.filter(l => isActive(l)).length;
            const inactive = licenses.length - active;
            const expiring = licenses.filter(l => {
                if (!isActive(l)) return false;
                const daysLeft = Math.ceil((new Date(l.expiryDate) - now) / (1000 * 60 * 60 * 24));
                return daysLeft <= 7;
            }).length;

            document.getElementById('activeCount').textContent = active;
            document.getElementById('inactiveCount').textContent = inactive;
            document.getElementById('expiringCount').textContent = expiring;
        }

        function searchLicenses() {
            renderLicenses();
        }

        function filterLicenses() {
            renderLicenses();
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            if (event.target.id === 'editModal') {
                closeEditModal();
            }
        }
    </script>
</body>
</html>
